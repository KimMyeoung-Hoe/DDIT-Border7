<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>ë§ˆì´í˜ì´ì§€</title>
	<!-- ê³µí†µcss -->
	<%@ include file="../modules/header.jsp" %>
	<%@ include file="../modules/sidebar.jsp" %>
	<%@ include file="../modules/modal.jsp" %>
	<link rel="stylesheet" href="/css/main.css" />
	<!-- confirm ëŒ€ì²´ -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
	<style>
		/* ì„ íƒëœ ë©”ì¼í•¨ ë“± ì¡°ê±´ì— ë”°ë¼ í‘œì‹œ/ë¹„í‘œì‹œë˜ëŠ” í•­ëª© */
		.toggle { /* ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„± */
			display: none;
		}
		.toggle.active {
			display: block;
		}
		.mail-viewer { /* ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ì „ì²´ ì˜ì—­ */
			display: none;
		}
        .mail-viewer.active { 
            display: flex;
            padding: 10px 20px 10px 20px;
            background-color: #fff;
            flex-direction: column;
			border-bottom-right-radius: 14px;
/* 			resize: horizontal; */
			flex-grow: 1;
        }
        .mail-viewer .mail-header table {
        	width: 100%;
        	table-layout: fixed;
        }
        .mail-list {
        	display: none;
        }
        .mail-list.active { /* ë©”ì¼ ëª©ë¡ ì˜ì—­ */
            overflow-y: auto;
            background-color: #fff;
            min-width: 450px;
            width: 40%;
            display: flex;
			flex-grow: 1;
			border-right: 1px solid #eee;
			flex-direction: column;
			align-items: center;
        }
	
		/* ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ */
        .btn-div { /* ì „ì²´ ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0px 10px 15px 10px;
            color: white;
        }
        .btn-div .btn { /* ì „ì²´ ë²„íŠ¼ */
            min-width: 90px;
            max-width: 90px;
            padding: 5px;
        }
        .btn-div .search-box { /* ê²€ìƒ‰ ì˜ì—­ */
            display: flex;
            align-items: center;
        }
        .btn-div .search-box > * { /* ê²€ìƒ‰ ì˜ì—­ì˜ ëª¨ë“  ìš”ì†Œ */
            margin-left: 5px;
        }
        .btn-div .left-buttons .btn { /* ì¢Œì¸¡ ë²„íŠ¼(í…œí”Œë¦¿ ì„ íƒ) */
        	min-width: 185px;
            max-width: 185px;
        }
        .category-title-span { /* ë©”ì¼í•¨ ì´ë¦„ */
        	font-size:28px;
        	color: #007bff;
        	margin: 0px;
        	padding: 0px;
        	font-weight: bold;
        	
        }
        
        /* ë©”ì¼ ì „ì²´ ì˜ì—­ */
        .mail-main-content {
            display: flex;
            min-height: 650px;
        }
        
        /* ë©”ì¼ ì‚¬ì´ë“œë°” ì˜ì—­ */
        .mail-sidebar { /* ì „ì²´ ë©”ì¼ ì‚¬ì´ë“œë°” ì˜ì—­ */
            min-width: 200px;
            padding: 20px 10px;
            border-right: 1px solid #eee;
            background-color: #f2f4fa;
        	border-bottom-left-radius: 12px;   
        	border-top-left-radius: 12px;   
        }
        .mail-sidebar .labels label { /* ì•ˆì½ìŒ, ì¤‘ìš”, ì²¨ë¶€íŒŒì¼ */
        	align-items: center;
        	text-align: center;
        	margin: 0px 4px;
        	font-size: 14px;
        }
        .mail-sidebar ul { /* ë©”ì¼í•¨ ëª©ë¡ ul */
            list-style: none;
            padding: 0;
            margin: 20px 0px;
            display:inline-block;
            align-content:Â flex-start;
            width: 100%;
            position: relative;
        }
        .mail-sidebar ul li { /* ë©”ì¼í•¨ ëª©ë¡ li */
            padding: 5px;
            cursor: pointer;
            display: flex;
        }
        .mail-sidebar ul li:hover,
        .mail-sidebar ul li.active { /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦°, í˜¹ì€ í˜„ì¬ ì„ íƒëœ ë©”ì¼í•¨ */
            font-weight: bold;
            color: #0d6efd;
        }
        .mail-sidebar ul li span.count { /* ë©”ì¼í•¨ì˜ ë©”ì¼ê°œìˆ˜ í‘œê¸° */
        	margin-right: 0px;
            font-size: 12px;
            color: #888;
            margin-top: 2px;
			position: absolute;
			right: 1px;
        }
        
        /* ë©”ì¼ ì˜ì—­ */
        .mail-list-div { /* ë©”ì¼ ì „ì²´ ì˜ì—­ */
            display: flex;
            border-right: 1px solid #eee;
            border-bottom: 1px solid #eee;
            width: 100%;
            flex-direction: column;
            border-top-right-radius: 14px;
            border-bottom-right-radius: 14px;
        }
        .mail-list-controls { /* ë©”ì¼ ê´€ë¦¬ ë²„íŠ¼ ì „ì²´ ì˜ì—­ */
            align-items: center;
            padding: 10px 15px;
            background-color: #3a3a50;
            border-bottom: 1px solid #eee;
            display: flex;
            width: 100%;
            box-sizing: border-box;
            border-top-right-radius: 14px;
            height: 50px;
        }
        .mail-list-controls > * { /* ë©”ì¼ ê´€ë¦¬ ë²„íŠ¼ ëª¨ë“  ìš”ì†Œë“¤ */
            margin-right: 10px;
        }
        .mail-list-controls .btn { /* ë©”ì¼ ê´€ë¦¬ ë²„íŠ¼ ë²„íŠ¼ */
        	background-color: #e0e0e0;
        	padding: 0px;
        	width: 70px;
        	height: 25px;
        	margin-right: 5px;
        }
        .mail-list-controls .btn.toggle-temp-select { /* ì´ì–´ì„œ ì‘ì„± ë²„íŠ¼ */
            width: 110px;
            margin-left: auto;
        }
        .mail-list-display { /* ë©”ì¼ ëª©ë¡ê³¼ ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ */
        	display: flex;
        	border-bottom-right-radius: 14px;
        	height: 100%;
        }
        .mail-list-table { /* ë©”ì¼ ëª©ë¡ í…Œì´ë¸” */
	        width: 100%;
	    	border-collapse: collapse;
        	overflow: hidden;
        	margin: 0;
        	table-layout: fixed;
        }
        .mail-item { /* ê°ê°ì˜ ë©”ì¼ í–‰ */
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin: 7px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .mail-item:hover, .mail-item.selected { /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦°, í˜¹ì€ ì„ íƒëœ ë©”ì¼ í–‰ */
            background-color: #eaf1fb; 
        }
        .mail-item input[type="checkbox"] {
            margin-right: 10px;
        }
        .tr-unread {
        	color: #0d6efd;
        }
        
        /* ë©”ì¼ ëª©ë¡ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ í•´ë‹¹ í–‰ ë°”íƒ•ìƒ‰ */
        .mail-list-table tr {
			transition: background-color 0.2s ease;
		}
		.mail-list-table tr:hover {
			background-color: #f5f5f5;
		}
        
        .td-checkbox { /* ë©”ì¼ ëª©ë¡ ì¤‘ ì²´í¬ë°•ìŠ¤ ì—´ */
        	padding: 0%;
        	width: 20px;
        	padding-left: 15px;
        }
        
        /* ì¤‘ìš”í•œ ë©”ì¼ ì²´í¬ ë³„ ì•„ì´ì½˜ */
        .like-button {
			background: none;
			border: none;
			cursor: pointer;
			padding: 0px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 15px;
			color: #555;
			transition: color 0.3s ease;
		}
		.star-icon { /* ê¸°ë³¸ ë³„ */
			width: 18px;
			height: 18px;
			transition: fill 0.3s ease, stroke 0.3s ease;
			fill: none;
			stroke: #888;
		}
		.like-button.liked .star-icon { /* í´ë¦­ ì‹œ ë³„ */
			fill: #FFA500;
			stroke: #FFA500;
		}
		.like-button:hover .star-icon { /* í˜¸ë²„ ì‹œ ë³„ */
		stroke: #FFA500;
		}
		.like-button.liked .star-icon { /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
			animation: starPulse 0.3s ease-in-out;
		}
		@keyframes starPulse {
			0% { transform: scale(1); }
			50% { transform: scale(1.2); }
			100% { transform: scale(1); }
		}
        
        .td-acount { /* ë©”ì¼ ëª©ë¡ ì¤‘ ë©”ì¼ì£¼ì†Œ ì—´ */
        	width: 25%;
        	border-right: 1px solid #eee;
        	white-space: nowrap; /* í…ìŠ¤íŠ¸ë¥¼ í•œ ì¤„ë¡œ */
		    overflow: hidden;    /* ì˜ì—­ì„ ë²—ì–´ë‚˜ë©´ ìˆ¨ê¹€ */
		    text-overflow: ellipsis; /* ìˆ¨ê¸´ ë‚´ìš© ... ì²˜ë¦¬ */
		    padding: 4px 10px 5px 18px;
        }
        .td-title { /* ë©”ì¼ ëª©ë¡ ì¤‘ ì œëª© ì—´ */
        	border-right: 1px solid #eee;
        	white-space: nowrap; /* í…ìŠ¤íŠ¸ë¥¼ í•œ ì¤„ë¡œ */
		    overflow: hidden;    /* ì˜ì—­ì„ ë²—ì–´ë‚˜ë©´ ìˆ¨ê¹€ */
		    text-overflow: ellipsis; /* ìˆ¨ê¸´ ë‚´ìš© ... ì²˜ë¦¬ */
		    padding: 4px 10px 5px 10px;
		    width: auto;
        }
        .td-date { /* ë©”ì¼ ëª©ë¡ ì¤‘ ë‚ ì§œ ì—´ */
        	width: 130px;
        	text-align: right;
        	padding-left: 2px;
        	padding-right: 10px;
        }
        .table-footer { /* í˜ì´ì§• ì˜ì—­ */
        	margin-top: auto;
        	bottom: 0;
        	width: 100%;
        }
/*         .mail-item .sender { */
/*             flex-grow: 1; */
/*             font-size: 14px; */
/*             color: #333; */
/*         } */
/*         .mail-item .title { */
/*             flex-grow: 3; */
/*             font-size: 14px; */
/*             color: #333; */
/*             white-space: nowrap; */
/*             overflow: hidden; */
/*             text-overflow: ellipsis; */
/*         } */
/*         .mail-item .date { */
/*             font-size: 13px; */
/*             color: #888; */
/*             margin-left: 15px; */
/*             white-space: nowrap; */
/*         } */
        
        /* ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ */
        .mail-viewer .mail-header { /* ë©”ì¼ í—¤ë” */
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .mail-viewer .mail-header h2 { /* ë©”ì¼ í—¤ë” - ë©”ì¼ ì œëª© */
            margin: 0;
            font-size: 20px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #viewBtn { /* ë„“ê²Œë³´ê¸°/ëª©ë¡ë³´ê¸° ë²„íŠ¼ */
        	margin-left: 5px;
        	background-color: #e0e0e0;
        	padding: 0px;
        	width: 90px;
        	height: 25px;
        }
        .td-datail-date-t {
        	text-align: right;
        	margin: 0px;
        	padding: 0px;
        }
        .td-datail-title-t .mail-detail-title {
        	font-weight: bold;
        	font-size: 24px;
        	color: #0d6efd;
        	margin: 0px;
        	padding: 0px;
        	display: block;
		    word-wrap: break-word;
		    overflow-wrap: break-word;
        }
        
        .td-datail-info-t {
        	margin-top: 5px;
        	min-width: 70px;
        	max-width: 70px;
        	vertical-align: top;
        }
        
        .td-datail-info-b {
		    width: auto;
		}
        .mail-detail-content * {
        	color: black;
        }
        .mail-viewer .mail-header .mail-detail-info { /* ë©”ì¼ í—¤ë” - ë³´ë‚¸ ì´, ë°›ëŠ” ì´ */
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        .mail-viewer .mail-detail-content-div { /* ë©”ì¼ ë³¸ë¬¸ */
            flex-grow: 1;
            overflow-y: scroll;
            font-size: 14px;
            line-height: 1.6;
            color: #444;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-right: 15px;
            height: 300px;
        }
        .mail-viewer .attachments { /* ì²¨ë¶€íŒŒì¼ */
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .mail-viewer .attachments h3 { /* ì²¨ë¶€íŒŒì¼ - ì˜ì—­ ì œëª©  */
            margin: 0 0 10px 0;
            font-size: 15px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .mail-viewer .attachments h3 button { /* ì²¨ë¶€íŒŒì¼ - ë‹¤ìš´ë¡œë“œ  */
            background-color: #e0e0e0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .mail-viewer .attachments ul { /* ì²¨ë¶€íŒŒì¼ - ì²¨ë¶€ëœ íŒŒì¼ ëª©ë¡ */
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .mail-viewer .attachments ul li { /* ì²¨ë¶€íŒŒì¼ - ì²¨ë¶€ëœ íŒŒì¼ í–‰ */
            padding: 5px 0;
            font-size: 14px;
            color: #555;
        }
        .mail-viewer-table th:first-child{
        	width: 70px;
        }
        .mail-viewer-table th:last-child{
        	width: calc(100% - 70);
        }
        
        #fileListContainer { /* ì²¨ë¶€íŒŒì¼ ëª©ë¡ */
		    list-style: none;
		    padding: 0;
		    margin: 3px 0; 
		    text-align: left;
		    display: block !important;
		}
        .file-save-btn { /* ê°œë³„ íŒŒì¼ ì‚­ì œ ë²„íŠ¼ */
        	background: none;
		    border: none;
		    font-size: 14px;
		    padding: 0px 5px;
        }
		#fileListContainer .attached-file-item { /* ê°œë³„ íŒŒì¼ í•­ëª© */
		    display: flex;
		    align-items: center;
		    justify-content: space-between;
		    padding: 0px 5px;
		    border-bottom: 1px dashed #eee;
		    font-size: 14px;
		    color: #555;
		    display: block !important;
		    width: 100% !important;
		    box-sizing: border-box;
		}
		.attached-file-item:last-child {
		    border-bottom: none; /* ë§ˆì§€ë§‰ í•­ëª©ì€ êµ¬ë¶„ì„  ì—†ìŒ */
		}
		.attached-file-item span {
		    margin-right: 5px;
		}
    </style>
	<%
        // ì„¸ì…˜ ë¡œê·¸ì¸ ê°’
        String userId = (String)session.getAttribute("userId");
		String authCode = (String)session.getAttribute("auth");
		
		
		// í˜„ì¬ ê²½ë¡œ
		String contextPath = request.getContextPath();
	%>
</head>
<body>
	<div class="app-container">
		<main class="main-content-area">

			<!-- í—¤ë” ì˜ì—­ -->
			<div class="content-header">
				<!-- ë¸Œë ˆë“œí¬ëŸ¼ ì—˜ë¦¬ë¨¼íŠ¸ -->
				<div class="breadcrumb-warp">
					<div class="col-sm-12">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="/">Home</a></li>
							<li class="breadcrumb-item">ë‚´ ë©”ì¼</li>
						</ol>
					</div>
				</div>
				<div id="contentTitle" class="content-title">ë‚´ ë©”ì¼</div>
				<p id="contentDesc" class="desc">Border7 ê³„ì • ë©”ì¼ë¡œ ì£¼ê³ ë°›ì€ ë©”ì¼ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
			</div>

			<!--  ë³¸ë¬¸ ì˜ì—­ ì‹œì‘ -->
			<div class="section">
				<!-- ìƒë‹¨ ë²„íŠ¼ ë° ê²€ìƒ‰ ì˜ì—­ -->
				<div class="btn-div">
					<div class="left-buttons">
						<button type="button" class="btn btn-primary" onclick="location.href='mailEdit.do'">ë©”ì¼ ì‘ì„±</button>
<!-- 						<button type="button" class="btn btn-primary">í…œí”Œë¦¿</button> -->
						<span class="category-title-span"></span>
					</div>
					<div class="search-box">
						<select id="searchType" name="search-key">
							<option value="emailTitle" ${pagingVO.searchType == 'emailTitle' ? 'selected' : ''}>ë©”ì¼ ì œëª©</option>
							<option value="emailAddress" ${pagingVO.searchType == 'emailAddress' ? 'selected' : ''}>ë©”ì¼ ì£¼ì†Œ</option>
						</select>
						<input id="searchWord" type="text" class="form-control" placeholder="ê²€ìƒ‰ í‚¤ì›Œë“œ ì…ë ¥" value="${pagingVO.searchWord }" />
						<button id="searchBtn" type="button" class="btn btn-primary">ë©”ì¼ ê²€ìƒ‰</button>
					</div>
				</div>

				<div class="mail-main-content">
					<!-- ë©”ì¼ ì‚¬ì´ë“œë°” -->
					<div class="mail-sidebar">
						<div class="labels">
							<label class="mail-label" data-category="unread">
								<span id="unreadCount">${myMailVO.unreadCount }</span>
								<br/>ì•ˆì½ìŒ
							</label>
							<label class="mail-label" data-category="star">â˜†<br/>ì¤‘ìš”</label>
							<label class="mail-label" data-category="files">ğŸ’¾<br/>ì²¨ë¶€íŒŒì¼</label>
		            	</div>
		                <ul class="categorys">
							<li class="category category-all" id="category-all" data-category="all">
								ì „ì²´ ë©”ì¼í•¨
								<span class="count">${myMailVO.allCount }</span>
							</li>
							<li class="category category-recip" id="category-recip" data-category="recip">
								ë°›ì€ ë©”ì¼í•¨
								<span class="count">${myMailVO.recipCount }</span>
		                    </li>
							<li class="category category-send" id="category-send" data-category="send">
		                    	ë³´ë‚¸ ë©”ì¼í•¨
								<span class="count">${myMailVO.sendCount }</span>
							</li>
							<li class="category category-temp" id="category-temp" data-category="temp">
								ì„ì‹œ ë³´ê´€í•¨
								<span class="count">${myMailVO.tempCount }</span>
							</li>
							<li class="category category-trash" id="category-trash" data-category="trash">
		                    	íœ´ì§€í†µ
								<span class="count">${myMailVO.trashCount }</span>
							</li>
						</ul>
					</div>

					<!-- ë©”ì¼ ì˜ì—­ -->
					<div class="mail-list-div">
						<!-- ë©”ì¼ ê´€ë¦¬ ì˜ì—­ -->
						<div class="mail-list-controls">
							<input type="checkbox" id="allCheck" />
							<p>ì„ íƒ ë©”ì¼</p>
							<button type="button" class="btn toggle toggle-read active" id="selectReadBtn" data-action="read">ì½ìŒ</button>
							<button type="button" class="btn toggle toggle-trash active" id="selectTrashBtn" data-action="trash">íœ´ì§€í†µ</button>
							<button type="button" class="btn toggle toggle-delete" id="selectDeleteBtn" data-action="delete">ì‚­ì œ</button>
							<form action="mailEdit.do" id="emailNoForm" method="post">
								<input type="hidden" name="emailNo" id="emailNo">
							</form>
							<button type="button" class="btn toggle toggle-temp-select" id="tempReBtn">ì´ì–´ì„œ ì‘ì„±</button>
							
						</div>
						
						<div class="mail-list-display">
			                <!-- ë©”ì¼ ëª©ë¡ ì˜ì—­ -->
							<div class="mail-list active">
			                    <table class="mail-list-table">
				                    <c:choose>
										<c:when test="${empty pagingVO.dataList}">
										    <tr>
										        <td colspan="5">ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
										    </tr>
										</c:when>
										<c:otherwise>
										    <c:forEach var="mails" items="${pagingVO.dataList}" varStatus="status" >
										        <tr id="tr_${mails['EMAIL_NO']}" data-index="${status.index}" data-emailno="${mails['EMAIL_NO']}" data-recipno="${mails['RECIP_NO']}" class="${mails['READ_YN'] == 0 ? 'tr-unread' : ''}">
										            <td class="td-checkbox">
										            	<input type="checkbox" name="selectMails" value="${mails['EMAIL_NO']}" data-recipno="${mails['RECIP_NO']}" />
									            	</td>
									            	<td class="td-checkbox td-star" data-staryn="${mails['STAR_YN'] }">
									            		<c:if test="${searchCategory ne 'trash' && searchCategory ne 'temp'}">
									            			<c:if test="${mails['STAR_YN'] eq '1'}">
															    <button class="like-button liked" aria-label="ì¢‹ì•„ìš”">
									            			</c:if>
									            			<c:if test="${mails['STAR_YN'] ne '1'}">
															    <button class="like-button" aria-label="ì¢‹ì•„ìš”">
									            			</c:if>
																<svg class="star-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
																	<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
																</svg>
															</button>
														</c:if>
										            </td>
									            	<td class="td-acount">
									            		<c:if test="${mails['COM_FILE_NO'] ne 0}">
															ğŸ’¾
														</c:if>
									            		<c:if test="${mails['EMAIL_CATEGORY'] eq 'recip'}">
															${mails['EMAIL_SENDER']}
														</c:if>
									            		<c:if test="${mails['EMAIL_CATEGORY'] ne 'recip'}">
										            		<c:choose>
											            		<c:when test="${fn:contains(mails['RECIP_EMAILS'], ',')}">
														            ${fn:substringBefore(mails['RECIP_EMAILS'], ',')} ì™¸
														        </c:when>
														        <c:otherwise>
														            ${mails['RECIP_EMAILS']}
														        </c:otherwise>
													        </c:choose>
														</c:if>
										            </td>
										            <td class="td-title">
										            	${mails['EMAIL_TITLE']}
										            </td>
										            <td class="td-date">
														<fmt:formatDate value="${mails['EMAIL_DATE']}" pattern="yy-MM-dd hh:mm" />
										            </td>
										        </tr>
										    </c:forEach>
										</c:otherwise>
									</c:choose>
			                    </table>
			                    <div class="table-footer">
						      		<div class="pagination" id="pagingArea">
								   		${pagingVO.pagingHTML}
									</div>
								</div>
			                </div>
			                
			                <!--  ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
			                <div class="mail-viewer">
				                <div class="mail-header">
				                	<table class="mail-viewer-table">
				                	<thead>
					                	<th></th>
					                	<th></th>
				                	</thead>
				                		<tr>
				                			<td colspan="2" class="td-datail-date-t">
				                				<span class="mail-detail-date"></span>
				                				<button type="button" class="btn" id="viewBtn">ë„“ê²Œ ë³´ê¸°</button>
				                			</td>
				                		</tr>
				                		<tr>
				                			<td colspan="2" class="td-datail-title-t">
							                	<span class="mail-detail-title"></span>
				                			</td>
				                		</tr>
				                		<tr>
				                			<td class="td-datail-info-t">
				                				ë³´ë‚¸ ì´ :
				                			</td>
				                			<td class="td-datail-info-b">
				                				<span class="mail-detail-send"></span>
				                			</td>
				                		</tr>
				                		<tr>
				                			<td class="td-datail-info-t">
				                				ë°›ëŠ” ì´ :
				                			</td>
				                			<td class="td-datail-info-b">
				                				<span class="mail-detail-recip"></span>
				                			</td>
				                		</tr>
				                	</table>
				                </div>
				                <div class="mail-detail-content-div">
				                	<span class="mail-detail-content"></span>
				                </div>
				                <div class="mail-detail-attachments">
				                    <h5>
				                        ì²¨ë¶€íŒŒì¼ <span class="mail-detail-fileCount"></span>
				                    </h5>
				                    <ul id="fileListContainer">
									</ul>
				                </div>
			            	</div>
			            </div>
		            </div>
		        </div>
			</div>
			<!-- ë³¸ë¬¸ ì˜ì—­ ë -->
		</main>
	</div>	
</body>
<script>
	$(document).ready(function () {
		// ê¸°ë³¸ URL
		let baseUrl = "/myPage/myMail.do";
		
		let searchCategory = '${searchCategory}';	// ë©”ì¼í•¨
		let searchType = "";						// ê²€ìƒ‰ìœ í˜•
        let searchWord = "";						// ê²€ìƒ‰ë‹¨ì–´
        
        // í™”ë©´ ê¸°ì´ˆ ì„¸íŒ…        
        $('.category').removeClass("active");
		$('#category-' + searchCategory).addClass("active");
		
		// ë²„íŠ¼ ë° ìƒë‹¨ í˜„ì¬ë©”ì¼í•¨ í‘œê¸° ì„¸íŒ…
		if(searchCategory == 'send' || searchCategory == 'temp') {
			$('.toggle-read').removeClass("active");
        	$('.toggle-trash').addClass("active");
        	$('.toggle-delete').removeClass("active");
        	$(".category-title-span").text(searchCategory == 'send' ? "ë³´ë‚¸ ë©”ì¼í•¨" : "ì„ì‹œ ë³´ê´€í•¨");
        }else if(searchCategory == 'trash') {
        	$('.toggle-read').removeClass("active");
        	$('.toggle-trash').removeClass("active");
        	$('.toggle-delete').addClass("active");
        	$(".category-title-span").text("íœ´ì§€í†µ");
        }else {
        	$('.toggle-read').addClass("active");
        	$('.toggle-trash').addClass("active");
        	$('.toggle-delete').removeClass("active");
        }
		if(searchCategory == 'all') {
        	$(".category-title-span").text("ì „ì²´ ë©”ì¼í•¨");
        }else if(searchCategory == 'recip') {
        	$(".category-title-span").text("ë°›ì€ ë©”ì¼í•¨");
        }else if(searchCategory == 'unread') {
        	$(".category-title-span").text("ì•ˆì½ì€ ë©”ì¼");
        }else if(searchCategory == 'star') {
        	$(".category-title-span").text("ì¤‘ìš”í•œ ë©”ì¼");
        }else if(searchCategory == 'files') {
        	$(".category-title-span").text("íŒŒì¼ì´ ì²¨ë¶€ëœ ë©”ì¼");
        }
		
		
		// ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
		$("#searchWord").keypress(function(event) {
	        if (event.which === 13) { 
	            $("#searchBtn").click();
	        }
	    });
		
		// ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²€ìƒ‰
		$("#searchBtn").on("click", function () {
			searchType = $("#searchType").val();
			searchWord = $("#searchWord").val();
			window.location.href = baseUrl + "?searchCategory=" + encodeURIComponent(searchCategory)
											+ "&searchType=" + encodeURIComponent(searchType)
											+ "&searchWord=" + encodeURIComponent(searchWord)
		});
		
		// ìƒë‹¨ ì²´í¬ë°•ìŠ¤(ì „ì²´ì„ íƒ/ì „ì²´í•´ì œ) í´ë¦­ ì²˜ë¦¬
		$("#allCheck").on('change', function() {
			const isChecked = this.checked; 
	        $('input[name="selectMails"]').prop('checked', isChecked);
	    });
		
		// ìƒë‹¨ ì½ìŒ / íœ´ì§€í†µ / ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
		$("#selectReadBtn, #selectTrashBtn, #selectDeleteBtn").on("click", function () {
			// ì½ìŒ / íœ´ì§€í†µ / ì‚­ì œ ì¸ì§€ êµ¬ë¶„
			const action = $(this).data('action');
			
			// ì„ íƒëœ ë©”ì¼ì˜ emailNoì™€ recipNoë¥¼ ì €ì¥
			let selectEmailData = [];
			$('input[name="selectMails"]:checked').each(function() {
				selectEmailData.push({
	                emailNo: $(this).val(),
	                recipNo: $(this).data('recipno')
	            });
			});
			
			if (selectEmailData.length === 0) {
				$.confirm({
					title: 'ë©”ì¼ ì¼ê´„ ì²˜ë¦¬',
					content: 'ì„ íƒëœ ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.',
					buttons: {
						"í™•ì¸": function() {}
					}
				});
	            return;
	        }
			
			if(action == "delete") {
				$.confirm({
					title: 'ë©”ì¼ ì‚­ì œ',
					content: 'ë©”ì¼ ì‚­ì œ ì‹œ ë³µì›ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
					buttons: {
						"ë„¤": function() {
							$.ajax({
					            url: '/myPage/mailAction',
					            type: 'POST',
					            dataType: 'text',
					            contentType: 'application/json',
					            data: JSON.stringify({
					            	actionType: action,
					            	selectEmailData: selectEmailData
					            }),
					            success: function(response) {
					            	console.log('ì„±ê³µ');
					            	location.reload();
					            },
					            error: function(xhr, status, error) {
					                console.error('AJAX ì‹¤íŒ¨:', status, error);
					            }
					        });},
						"ì•„ë‹ˆìš”": function() {return;}
					}
				});
			}else {
				$.ajax({
		            url: '/myPage/mailAction',
		            type: 'POST',
		            dataType: 'text',
		            contentType: 'application/json',
		            data: JSON.stringify({
		            	actionType: action,
		            	selectEmailData: selectEmailData
		            }),
		            success: function(response) {
		            	console.log('ì„±ê³µ');
		            	location.reload();
		            },
		            error: function(xhr, status, error) {
		                console.error('AJAX ì‹¤íŒ¨:', status, error);
		            }
		        });
			}
			
			
			
		});
		
		// ì•ˆì½ìŒ/ì¤‘ìš”/ì²¨ë¶€íŒŒì¼ í´ë¦­í•˜ë©´
		$(".mail-label").on('click', function() {
			searchCategory = $(this).data("category");
			window.location.href = baseUrl + "?searchCategory=" + encodeURIComponent(searchCategory);
		});
		
		// ë©”ì¼í•¨ì„ í´ë¦­í•˜ë©´
		$('.category').on('click', function() {
			searchCategory = $(this).data("category");
			window.location.href = baseUrl + "?searchCategory=" + encodeURIComponent(searchCategory);
		});
		
		// í˜ì´ì§• ë²ˆí˜¸ë¥¼ í´ë¦­í•˜ë©´
		$(".pagination").find(".page-link").on("click", function (event) {
	     	event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±° (í´ë¦­ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€)
			
	        let page = $(this).attr("data-page");
	        
	        searchType = $("#searchType").val();
			searchWord = $("#searchWord").val();
			
	        if(!page){page = 1;}
	        
	        window.location.href = baseUrl + "?page=" + encodeURIComponent(page)
	        								+ "&searchCategory=" + encodeURIComponent(searchCategory)
									        + "&searchType=" + encodeURIComponent(searchType)
									        + "&searchWord=" + encodeURIComponent(searchWord);
	    });
		
		// ì¤‘ìš”í•œ ë©”ì¼ ì„¤ì • (ë³„ ì•„ì´ì½˜ í´ë¦­ ì‹œ ì´ë²¤íŠ¸)
		$('.like-button').on('click', function(event) {
	        event.stopPropagation(); // ê¸°ì¡´ì— trì— ê±¸ë¦° ì´ë²¤íŠ¸ ë°œìƒ ë°©ì§€
	
	        const $thisButton = $(this);
	        let isLiked = $thisButton.hasClass('liked'); // í˜„ì¬ ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸
	
	        if (isLiked) {
	            $thisButton.removeClass('liked'); // liked í´ë˜ìŠ¤ ì œê±° (ì¢‹ì•„ìš” ì·¨ì†Œ)
	            isLiked = false;
	        } else {
	            $thisButton.addClass('liked'); // liked í´ë˜ìŠ¤ ì¶”ê°€ (ì¢‹ì•„ìš”)
	            isLiked = true;
	        }
	
	        const $parentTr = $thisButton.closest('tr');
	        const emailNo = $parentTr.data('emailno');
	        const recipNo = $parentTr.data('recipno');
	
	        $.ajax({
	            url: '/myPage/updateStar',
	            type: 'POST',
	            data: {
	                emailNo: emailNo,
	                recipNo: recipNo,
	                isLiked: isLiked
	            },
	            success: function(response) {
	                console.log('ì„œë²„ ì‘ë‹µ:', response);
	            },
	            error: function(error) {
	                console.error('ì¢‹ì•„ìš” ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
	                $thisButton.toggleClass('liked'); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒíƒœ ë˜ëŒë¦¼
	            }
	        });
	    });
		
		// ë©”ì¼ì„ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸° ë·° í‘œì‹œ
		$('tr[id^="tr_"]').on('click', function() {
			let emailNo = $(this).data('emailno');
			
			//ì„ íƒí•œ ë©”ì¼ì´ ë°›ì€ ë©”ì¼ì´ê³  ì•„ì§ ì•ˆ ì½ì€ ë©”ì¼ì´ë©´ ì½ìŒ ì²˜ë¦¬
			let recipno = $(this).data('recipno');
			$(this).removeClass("tr-unread");
			if(recipno != null && recipno != 0 && recipno != "") {
				let selectEmailData = [{
					emailNo: emailNo,
					recipNo: recipno
				}];
				
				$.ajax({
		            url: '/myPage/mailAction',
		            type: 'POST',
		            dataType: 'text',
		            contentType: 'application/json',
		            data: JSON.stringify({
		            	actionType: 'read',
		            	selectEmailData: selectEmailData
		            }),
		            success: function(response) {
		            	console.log('ì½ìŒ ì„±ê³µ');
		            },
		            error: function(xhr, status, error) {
		                console.error('AJAX ì‹¤íŒ¨:', status, error);
		            }
		        });
			}
			
	        $('.mail-viewer').addClass("active");
	        
	        
	        $.ajax({
	            url: '/myPage/mailDetailContent',
	            type: 'POST',
	            data: {
	                emailNo: emailNo
	            },
	            success: function(response) {
	            	console.log(response);
	            	$(".mail-detail-date").text(response.emailDate);
	            	$(".mail-detail-title").text(response.emailTitle);
	            	$(".mail-detail-send").text(response.emailSender);
	            	$(".mail-detail-recip").text(response.recipEmails);
	            	$(".mail-detail-content").html(response.emailContent);
	            	$('#emailNo').val(response.emailNo);
	            	$("#unreadCount").text(response.unreadCount);
	            	console.log(response.unreadCount);
	            	$('.mail-detail-fileCount').text("0ê±´");
	            	if(response.emailFileList) {
	            		const $fileListContainer = $('#fileListContainer');
	                    $fileListContainer.empty();
	                    const fileListLength = response.emailFileList.length;
	                    $('#mail-detail-fileCount').text(fileListLength + "ê±´");
	                    response.emailFileList.forEach(function(fileItem, index) {
	                    	
	                        const fileSize = (fileItem.comFileDetailSize / 1024).toFixed(2);
	                        const fileName = fileItem.comFileDetailOriginalName;

	                        // ìƒˆë¡œìš´ <li> ìš”ì†Œ ìƒì„±
	                        const $listItem = $('<li></li>')
	                            .addClass('attached-file-item')
	                            // data-comfileno ì†ì„± ì¶”ê°€
	                            .attr('data-comfileno', fileItem.comFileNo);

	                        // ì €ì¥ ë²„íŠ¼ ì¶”ê°€
	                        const $saveButton = $('<button type="button" class="file-save-btn">ğŸ’¾</button>');
	                        $saveButton.on('click', function() {

	                            const $downloadLink = $('<a>')
	                                .attr('href', "/myPage/download.do?comFileDetailNo=" + fileItem.comFileDetailNo)
	                                .css('display', 'none'); // í™”ë©´ì— ë³´ì´ì§€ ì•Šë„ë¡ ìˆ¨ê¹€

	                            $('body').append($downloadLink); // DOMì— ì¶”ê°€ (í•„ìš”)
	                            $downloadLink[0].click(); // í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ
	                            $downloadLink.remove(); // í´ë¦­ í›„ DOMì—ì„œ ì œê±°

	                            console.log(`íŒŒì¼ No. ${fileItem.comFileNo} ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ë¨`);
	                            console.log(`ë‹¤ìš´ë¡œë“œ ê²½ë¡œ: ${fileItem.comFileDetailSavePath}`);
	                        });
	                        
	                        $listItem.append($saveButton);

	                        // íŒŒì¼ ì •ë³´ í…ìŠ¤íŠ¸ ì¶”ê°€
	                        $listItem.append("<span>" + fileName + "</span> - <span>" + fileSize +"KB</span>");

	                        // ul ì»¨í…Œì´ë„ˆì— li ì¶”ê°€
	                        $fileListContainer.append($listItem);
	                    });
	            	}
	            },
	            error: function(xhr, status, error) {
	                console.error('AJAX ì‹¤íŒ¨:', status, error);
	            }
	        });
	        
	        if(searchCategory == 'temp') {
	        	$('.toggle-temp-select').addClass("active");
	        }
	        
	    });
		
		// ë¯¸ë¦¬ë³´ê¸° ë·° ì™¸ì˜ ì˜ì—­ í´ë¦­ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë·° ë‹«ê¸°
		$(document).on('click', function(event) {
	        const $target = $(event.target); // í´ë¦­ëœ ìš”ì†Œ
	
	        // 1. í´ë¦­ëœ ìš”ì†Œê°€ .mail-viewer div ìì²´ì´ê±°ë‚˜ ê·¸ ìì†ì¸ì§€ í™•ì¸
	        const isInsideMailViewer = $target.closest('.mail-viewer').length > 0;
	
	        // 2. í´ë¦­ëœ ìš”ì†Œê°€ td[id^="td_"] ìì²´ì´ê±°ë‚˜ ê·¸ ìì†ì¸ì§€ í™•ì¸
	        const isInsideMailListItem = $target.closest('tr[id^="tr_"]').length > 0;
	
	     	// 3. í´ë¦­ëœ ìš”ì†Œê°€ .btn-div ë‚´ë¶€ì˜ ë²„íŠ¼ì´ ì•„ë‹Œì§€ í™•ì¸ (ë²„íŠ¼ í´ë¦­ ì‹œë„ ë²„íŠ¼ ë¹„í™œì„± ë°©ì§€)
	        const isButton = $target.hasClass('toggle');
	     	
	        // .mail-viewer ë‚´ë¶€ë„ ì•„ë‹ˆê³ , td[id^="td_"] ë‚´ë¶€ë„ ì•„ë‹ ê²½ìš°ì—ë§Œ .mail-viewerë¥¼ ìˆ¨ê¹€
	        if (!isInsideMailViewer && !isInsideMailListItem && !isButton) {
	        	$('.mail-viewer').removeClass('active');
	        	$('.toggle-temp-select').removeClass('active');
	        }
	    });

		// ë„“ê²Œ ë³´ê¸° / ëª©ë¡ ë³´ê¸°
		$("#viewBtn").on("click", function () {
			if($("#viewBtn").text() == "ë„“ê²Œ ë³´ê¸°") {
				$('.mail-list').removeClass('active');
				$("#viewBtn").text("ëª©ë¡ ë³´ê¸°");
			}else {
				$('.mail-list').addClass('active');
				$("#viewBtn").text("ë„“ê²Œ ë³´ê¸°");
			}
		});
		
		// ì„ì‹œ ë³´ê´€í•¨ - ì´ì–´ì„œ ì‘ì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ê¸°ì¡´ ê°’ì„ ê°€ì§€ê³  ë©”ì¼ ì‘ì„± í™”ë©´ìœ¼ë¡œ ì´ë™)
		$("#tempReBtn").on("click", function () {
			$('#emailNoForm').submit();
		});
		
	});
</script>
</html>