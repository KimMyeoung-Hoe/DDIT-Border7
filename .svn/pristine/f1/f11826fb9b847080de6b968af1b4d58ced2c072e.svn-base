<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒì„¸ ì˜ë¢°í˜„í™©</title>
<%@ include file="../modules/header.jsp"%>
<%@ include file="../modules/sidebar.jsp"%>
<%@ include file="../modules/modal.jsp"%>
<link rel="stylesheet" href="/css/main.css">
<style>
/* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
/* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
@keyframes blink-animation {
    0% { opacity: 1; }
    50% { opacity: 0.2; }
    100% { opacity: 1; }
}
.blink {
	animation: blink-animation 1s infinite alternate;
	font-weight: bold;
	color: red;
	margin-left: 5px;
	display: inline-block;
}
</style>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
	<div class="app-container">
		<main class="main-content-area">

			<div class="content-header">
				<!-- ë¸Œë ˆë“œí¬ëŸ¼ ì—˜ë¦¬ë¨¼íŠ¸ -->
				<div class="breadcrumb-warp">
					<div class="col-sm-12">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="/">Home</a></li>
							<li class="breadcrumb-item"><a href="/cca/ccaContract">ì ‘ìˆ˜ë‚´ì—­</a></li>
							<li class="breadcrumb-item"><a href="#">ì˜ë¢° ì§„í–‰ ìƒì„¸</a></li>
						</ol>
					</div>
				</div>

				<div class="content-title" title="gg">ì˜ë¢° ì§„í–‰ ìƒì„¸</div>
				<p class="desc">ì ‘ìˆ˜ëœ ì˜ë¢°ì˜ ìƒì„¸ ë‚´ì—­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
			</div>
			<div class="container section">
				<!-- Progress Section -->
				<div class="progress-section">
					<div class="progress-bar-container">
						<div class="progress-bar">
							<c:forEach items="${categoryBar }" var="bar"
								varStatus="categoryStatus">
								<c:set var="currentCategoryName"
									value="${bar.statusCodeMediumCategoryName}" />

								<c:set var="isActive" value="false" />

								<c:forEach items="${contractVo.contractRecordList }"
									var="record" varStatus="recordStatus">
									<c:if
										test="${record.statusCodeMediumCategoryName eq currentCategoryName}">
										<c:set var="isActive" value="true" />
									</c:if>
								</c:forEach>

								<div class="progress-step">
									<button class="step-circle ${isActive ? 'active' : 'inactive'}">
										${categoryStatus.index + 1}</button>
									<span class="step-label">${bar.statusCodeMediumCategoryName}</span>
									<div class="progress-details"
										id="details-step-${categoryStatus.index + 1}"
										style="display: none;">
										<div
											style="color: black; font-size: 12px; margin-left: 60px; width: 300px"
											class="divArea"></div>
									</div>
								</div>
							</c:forEach>
						</div>

					</div>
				</div>

				<!-- Content Section -->
				<div class="content-section content-section-2nd">
					<div class="tabs-container">
						<div class="tabs-header">
							<div class="tab-button active categories-title" data-tab="detail">
								ìƒì„¸ì •ë³´</div>
							<div class="tab-button categories-title" data-tab="document">
								ì„œë¥˜ê´€ë¦¬</div>
							<c:if
								test="${contractVo.contractType == 'ìˆ˜ì…' and contractVo.lastStatusCode > 16}">
								<div
									class="tab-button categories-title <c:if test="${contractVo.lastStatusCode == 17 }">blink</c:if>"
									data-tab="duty">ì„¸ê¸ˆë‚©ë¶€</div>
							</c:if>
							<c:if
								test="${contractVo.lastStatusCode >= 19 or contractVo.lastStatusCode >=38}">
								<c:if test="${contractVo.contractType == 'ìˆ˜ì…' }">
									<div
									class="tab-button categories-title <c:if test="${contractVo.lastStatusCode == 19 }">blink</c:if>"
									data-tab="item">ë¬¼í’ˆì°½ê³ </div>
								</c:if>
								<c:if test="${contractVo.contractType == 'ìˆ˜ì¶œ' }">
									<div
									class="tab-button categories-title <c:if test="${contractVo.lastStatusCode == 38 }">blink</c:if>"
									data-tab="item">ì»¨í…Œì´ë„ˆ</div>
								</c:if>
								
							</c:if>
							<!-- <div class="tab-button categories-title" data-tab="progress">
								ì§„í–‰ë‚´ì—­</div> -->
						</div>

						<div class="tabs-content">

							<div class="tab-pane active category-options" id="detail">
								<div class="info-card">
									<div class="info-row">
										<span class="card-title">ì˜ë¢° ì •ë³´</span>
									</div>

									<div class="info-row">
										<span class="info-label">ê³„ì•½ ë²ˆí˜¸</span> <span class="info-value">${contractVo.contractNo }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë“±ë¡ì¼</span> <span class="info-value">${contractVo.contractDate }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ì˜ë¢° ìœ í˜•</span> <span class="info-value">${contractVo.contractType }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆëª…</span> <span class="info-value">${contractVo.productVO.productName }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ì›ì‚°ì§€</span> <span
											class="info-value">${contractVo.productVO.productOrigin }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ìˆ˜ëŸ‰</span> <span class="info-value">${contractVo.productVO.productQty }
											ê°œ</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ì¤‘ëŸ‰</span> <span class="info-value">${contractVo.productVO.productWeight }
											KG</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ë¶€í”¼</span> <span class="info-value">${contractVo.productVO.productVolume}
											CBM</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ë‹¨ê°€</span> <span class="info-value"><fmt:formatNumber
												value="${contractVo.productVO.productPrice}" pattern="#,###" />
											ì›</span>
									</div>

								</div>
								<!-- Manager Information -->
								<div class="info-card">
									<div class="info-row">
										<span class="card-title" style="margin-right: 10px">ë‹´ë‹¹ì
											ì •ë³´</span>
										<button class="" style="border: 1px solid;" id="maskedBtn">
											<i class="fas fa-eye"></i>
										</button>
									</div>

									<div>
										<div class="info-row">
											<span class="info-label">ì˜ë¢°ì¸</span> <span class="info-value">${contractVo.consignorCompanyName}</span>
										</div>

										<div class="info-row">
											<span class="info-label">ë‹´ë‹¹ì</span>
											<div class="info-value">
												<div style="font-weight: bold; margin-bottom: 10px;">
													<span id="maskedConsignorName">${contractVo.consignorName }</span>
												</div>
												<div class="contact-info"
													style="font-weight: bold; margin-bottom: 10px;">
													<div class="ccaTel">ğŸ“ ${contractVo.consignorTel }</div>
													<div class="userTel">
														ğŸ“± <span id="maskedConsignorTel">${contractVo.consignorUserTel }</span>
													</div>
													<div class="ccaUserFax">ğŸ“ 
														${contractVo.consignorUserFax }</div>
													<div class="ccaUserEmail">âœ‰ï¸
														${contractVo.consignorUserEmail }</div>
												</div>
											</div>
										</div>

										<c:if test="${! empty servantVo }">

											<div class="info-row">
												<span class="info-label">ë‹´ë‹¹ ê³µë¬´ì›</span> <span
													class="info-value"><span id="maskedServantName">${servantVo.userName}</span></span>
											</div>
											<div class="info-row">
												<span class="info-label">ì§ê¸‰</span> <span class="info-value">
													${servantVo.jobGradeName}</span>
											</div>

											<div class="info-row">
												<span class="info-label">ë¶€ì„œ</span>
												<div class="info-value">
													<div style="font-weight: bold; margin-bottom: 10px;">${servantVo.deptName}</div>
													<div class="contact-info"
														style="font-weight: bold; margin-bottom: 10px;">
														<div class="ccaTel">ğŸ“ ${servantVo.deptTel }</div>
														<div class="userTel">
															ğŸ“± <span id="maskedServantTel">${servantVo.userTel }</span>
														</div>
														<div class="ccaUserFax">ğŸ“  ${servantVo.userFax }</div>
														<div class="ccaUserEmail">âœ‰ï¸ ${servantVo.userEmail }</div>
													</div>
												</div>
											</div>

										</c:if>

									</div>
								</div>
							</div>
							<div class="tab-pane" id="document">
								<div class="info-card">
									<div class="info-row">
										<span class="card-title">ì˜ë¢° ì •ë³´</span>
									</div>

									<div class="info-row">
										<span class="info-label">ê³„ì•½ ë²ˆí˜¸</span> <span class="info-value">${contractVo.contractNo }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë“±ë¡ì¼</span> <span class="info-value">${contractVo.contractDate }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ì˜ë¢° ìœ í˜•</span> <span class="info-value">${contractVo.contractType }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆëª…</span> <span class="info-value">${contractVo.productVO.productName }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ì›ì‚°ì§€</span> <span
											class="info-value">${contractVo.productVO.productOrigin }</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ìˆ˜ëŸ‰</span> <span class="info-value">${contractVo.productVO.productQty }
											ê°œ</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ì¤‘ëŸ‰</span> <span class="info-value">${contractVo.productVO.productWeight }
											KG</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ë¶€í”¼</span> <span class="info-value">${contractVo.productVO.productVolume}
											CBM</span>
									</div>

									<div class="info-row">
										<span class="info-label">ë¬¼í’ˆ ë‹¨ê°€</span> <span class="info-value"><fmt:formatNumber
												value="${contractVo.productVO.productPrice}" pattern="#,###" />
											ì›</span>
									</div>

								</div>
								<div class="info-card">
									<div class="info-row">
										<span class="card-title">ì„œë¥˜</span>
									</div>
									<ul class="file-list">
										<li class="file-item">
											<div class="file-info">
												<i class="fas fa-file-alt"></i>
												<div class="file-details">
													<span class="file-name">ìƒì—…ì†¡ì¥.pdf (CI)</span>
													<fmt:parseDate value="${contractVo.contractDate }"
														var="ciDate" pattern="yyyy-MM-dd HH:mm:ss" />
													<span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <fmt:formatDate
															value="${ciDate }" pattern="yyyy-MM-dd HH:mm:ss" /></span>

												</div>
											</div>
											<div class="file-actions">
												<a href="/pdf/download/ci/${contractVo.ciNo }"
													class="action-button secondary" id="ciDlBtn"><i
													class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
												<button class="btn btn-primary" id="ciBtn"
													value="${contractVo.ciNo }">
													<i class="fas fa-edit"></i> ìƒì„¸
												</button>
											</div>
										</li>
										<li class="file-item">
											<div class="file-info">
												<i class="fas fa-file-alt"></i>
												<div class="file-details">
													<span class="file-name">íŒ¨í‚¹ë¦¬ìŠ¤íŠ¸.pdf (PL)</span>
													<fmt:parseDate value="${contractVo.contractDate }"
														var="plDate" pattern="yyyy-MM-dd HH:mm:ss" />
													<span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <fmt:formatDate
															value="${plDate }" pattern="yyyy-MM-dd HH:mm:ss" /></span>
												</div>
											</div>
											<div class="file-actions">
												<a href="/pdf/download/pl/${contractVo.plNo }"
													class="action-button secondary" id="plDlBtn"><i
													class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
												<button class="btn btn-primary" id="plBtn"
													value="${contractVo.plNo }">
													<i class="fas fa-edit"></i> ìƒì„¸
												</button>
											</div>
										</li>

										<c:set var="getStatusCode"
											value="${contractVo.lastStatusCode }" />
										<c:choose>
											<c:when
												test="${getStatusCode == 2 || getStatusCode == 3 || getStatusCode == 4 || getStatusCode == 5
										|| getStatusCode == 23 || getStatusCode == 24 || getStatusCode == 25 || getStatusCode == 26}">
										ì°¨ë‹¨
									</c:when>
											<c:otherwise>
												<c:choose>
													<c:when
														test="${fn:substring(contractVo.contractNo, 0, 3) == 'IMP'}">
														<li class="file-item">
															<div class="file-info">
																<i class="fas fa-file-alt"></i>
																<div class="file-details">
																	<span class="file-name">í•œê¸€í‘œì‹œì‚¬í•­</span> <span
																		class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <c:choose>
																			<c:when test="${empty krNotationVO.regDate}">
																        ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
																    </c:when>
																			<c:otherwise>
																				<fmt:formatDate value="${krNotationVO.regDate}"
																					pattern="yyyy-MM-dd HH:mm:ss" />
																			</c:otherwise>
																		</c:choose>
																	</span>

																</div>
															</div>
															<div class="file-actions">
																<c:choose>
																	<c:when
																		test="${not empty krNotationVO.packagingMaterialKr}">
																		<a
																			href="/pdf/download2.do?url=cca/koreanLabelDetail.do?contractNo=${contractVo.contractNo }"
																			class="action-button secondary" id="knDlBtn"><i
																			class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
																		<button class="btn btn-primary" id="kLabelDetailBtn"
																			value="${contractVo.contractNo }">
																			<i class="fas fa-edit"></i> ìƒì„¸
																		</button>
																	</c:when>
																	<c:otherwise>
																		<button class="btn btn-primary" id="kLabelWriteBtn"
																			value="${contractVo.contractNo }">
																			<i class="fas fa-edit"></i> ì‘ì„±
																		</button>
																	</c:otherwise>
																</c:choose>
															</div>
														</li>
														<li class="file-item">
															<div class="file-info">
																<i class="fas fa-file-alt"></i>
																<div class="file-details">
																	<span class="file-name">${contractVo.contractType }ì‹ ê³ ì„œ</span>
																	<span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <c:choose>
																			<c:when test="${empty contractDelNo[0].declDNo}">
																        ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
																    </c:when>
																			<c:otherwise>
																				<fmt:parseDate
																					value="${contractDelNo[0].contractFileDate}"
																					var="declDDate" pattern="yyyy-MM-dd HH:mm:ss" />
																				<fmt:formatDate value="${declDDate}"
																					pattern="yyyy-MM-dd HH:mm:ss" />
																			</c:otherwise>
																		</c:choose>
																	</span>
																</div>
															</div>
															<div class="file-actions">
																<c:choose>
																	<c:when
																		test="${empty krNotationVO.packagingMaterialKr}">
																		<button class="btn btn-warning" id=""
																			value="${contractDelNo[0].declDNo }">
																			<i class="fas fa-edit"></i> ëŒ€ê¸°ì¤‘
																		</button>
																	</c:when>
																	<c:when test="${contractDelNo[0].declDNo != null}">
																		<a
																			href="/pdf/download2.do?url=contract/decl/detail.do?declDNo=${contractDelNo[0].declDNo }"
																			class="action-button secondary" id="declDlBtn"><i
																			class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
																		<button class="btn btn-primary" id="delDBtn"
																			value="${contractDelNo[0].declDNo }">
																			<i class="fas fa-edit"></i> ìƒì„¸
																		</button>
																	</c:when>
																	<c:otherwise>
																		<button class="btn btn-primary" id="delDWriteBtn"
																			value="${contractVo.contractNo }">
																			<i class="fas fa-edit"></i> ì‘ì„±
																		</button>
																	</c:otherwise>
																</c:choose>
															</div>
														</li>
													</c:when>
													<c:otherwise>
														<li class="file-item">
															<div class="file-info">
																<i class="fas fa-file-alt"></i>
																<div class="file-details">
																	<span class="file-name">${contractVo.contractType }ì‹ ê³ ì„œ</span>
																	<span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <c:choose>
																			<c:when test="${empty contractDelNo[0].declDNo}">
																        ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
																    </c:when>
																			<c:otherwise>
																				<fmt:parseDate
																					value="${contractDelNo[0].contractFileDate}"
																					var="declDDate" pattern="yyyy-MM-dd HH:mm:ss" />
																				<fmt:formatDate value="${declDDate}"
																					pattern="yyyy-MM-dd HH:mm:ss" />
																			</c:otherwise>
																		</c:choose>
																	</span>
																</div>
															</div>
															<div class="file-actions">
																<c:choose>
																	<c:when test="${contractDelNo[0].declDNo != null}">
																		<a
																			href="/pdf/download2.do?url=contract/decl/detail.do?declDNo=${contractDelNo[0].declDNo }"
																			class="action-button secondary" id="declDlBtn"><i
																			class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
																		<button class="btn btn-primary" id="delDBtn"
																			value="${contractDelNo[0].declDNo }">
																			<i class="fas fa-edit"></i> ìƒì„¸
																		</button>
																	</c:when>
																	<c:otherwise>
																		<button class="btn btn-primary" id="delDWriteBtn"
																			value="${contractVo.contractNo }">
																			<i class="fas fa-edit"></i> ì‘ì„±
																		</button>
																	</c:otherwise>
																</c:choose>
															</div>
														</li>
													</c:otherwise>
												</c:choose>

												<%-- <c:if test="${fn:substring(contractVo.contractNo, 0, 3) == 'IMP'}">
				                        	<li class="file-item">
				                                <div class="file-info">
				                                    <i class="fas fa-file-alt"></i>
				                                    <div class="file-details">
				                                        <span class="file-name">ì„¸ê¸ˆê³ ì§€ì„œ</span>
				                                        <span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: 2025-05-10</span>
				                                    </div>
				                                </div>
				                                <div class="file-actions">
				                                	<button class="btn btn-warning" id="" value="${contractVo.contractNo }"><i class="fas fa-edit"></i> ëŒ€ê¸°ì¤‘</button>
				                                	<c:choose>
		                                    			<c:when test="${contractDelNo[0].declDNo != null}">
		                                    				<a href="/pdf/download2.do?url=contract/decl/detail.do?declDNo=${contractDelNo[0].declDNo }"  class="action-button secondary" id="declDlBtn"><i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
						                                    <button class="btn btn-primary" id="delDBtn" value="${contractDelNo[0].declDNo }"><i class="fas fa-edit"></i> ìƒì„¸</button>
		                                     			</c:when>
														<c:otherwise>
					                                    	<button class="btn btn-warning" id="" value="${contractVo.contractNo }"><i class="fas fa-edit"></i> ëŒ€ê¸°ì¤‘</button>
													    </c:otherwise>
													</c:choose>
				                                </div>
				                            </li>
				                        </c:if> --%>

												<li class="file-item">
													<div class="file-info">
														<i class="fas fa-file-alt"></i>
														<div class="file-details">
															<span class="file-name">${contractVo.contractType }ì‹ ê³ í•„ì¦</span>
															<span class="file-meta">ìµœì¢… ì—…ë°ì´íŠ¸: <c:choose>
																	<c:when test="${empty CDVO.cdDate }">
														        ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
														    </c:when>
																	<c:otherwise>
																		<%-- <fmt:parseDate value="${CDVO.cdDate }" var="cdDate" pattern="yyyy-MM-dd" /> --%>
																		<fmt:formatDate value="${CDVO.cdDate}"
																			pattern="yyyy-MM-dd HH:mm:ss" />
																	</c:otherwise>
																</c:choose>

															</span>
														</div>
													</div>
													<div class="file-actions">
														<c:choose>
															<c:when test="${not empty CDVO.cdDate }">
																<a
																	href="/pdf/download2.do?url=servant/cdDetail.do?cdNo=${CDVO.cdNo }"
																	class="action-button secondary" id="declDlBtn"><i
																	class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
																<button class="btn btn-primary" id="cdBtn"
																	value="${CDVO.cdNo }">
																	<i class="fas fa-edit"></i> ìƒì„¸
																</button>
															</c:when>
															<c:otherwise>
																<button class="btn btn-warning" id=""
																	value="${contractVo.contractNo }">
																	<i class="fas fa-edit"></i> ëŒ€ê¸°ì¤‘
																</button>
															</c:otherwise>
														</c:choose>
													</div>
												</li>
											</c:otherwise>
										</c:choose>
									</ul>
								</div>
							</div>

							<c:if test="${contractVo.contractType == 'ìˆ˜ì…' }">
								<div class="tab-pane" id="duty">
									<div class="info-card">
										<div class="info-row">
											<span class="card-title">ì„¸ê¸ˆ ë‚©ë¶€</span>
										</div>
										<div>

											<c:if test="${contractVo.lastStatusCode == 17 }">
												<div class="info-row">
													<span class="info-label blink" style="width: 500px;">ì„¸ê¸ˆ
														ê³ ì§€ì„œê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!</span>
												</div>

												<div class="info-row">
													<span class="info-label">ê³ ì§€ì„œ ë³´ê¸° :</span><%--  <a
														href="/doc/taxBill.do?declNo=${declNo }"
														class="action-button secondary "><i
														class="fas fa-edit"></i> ìƒì„¸</a> --%>
													<button class="btn btn-primary" id="taxBtn" value="${declNo }">
														<i class="fas fa-edit"></i> ìƒì„¸
													</button>
												</div>


											</c:if>
											<c:if test="${contractVo.lastStatusCode != 17 }">
												<div class="info-row">
													<i class="fas fa-check-circle"></i> ì„¸ê¸ˆ ë‚©ë¶€ê°€ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
												</div>
												<div class="info-row">
													<span class="info-label">ê³ ì§€ì„œ ë³´ê¸° :</span> <%-- <a
														href="/doc/taxBill.do?declNo=${declNo }"
														class="action-button secondary "><i
														class="fas fa-edit"></i> ìƒì„¸</a> --%>
														<button class="btn btn-primary" id="taxOkBtn" value="${declNo }">
														<i class="fas fa-edit"></i> ìƒì„¸
													</button>
												</div>
											</c:if>

										</div>

									</div>
								</div>
							</c:if>

							<div class="tab-pane" id="item">
								<c:if test="${contractVo.contractType == 'ìˆ˜ì…' }">
									<div class="info-card">
										<div class="info-row">
											<span class="card-title">ë¬¼í’ˆ ì ì¬</span>
										</div>
										<c:if test="${contractVo.lastStatusCode == 19 }">
											<div>
												<div class="info-row">
													<span class="info-label">ë¬¼í’ˆ ì ì¬ ì‹ ì²­</span> <a
														href="/cca/stowageList.do" class="action-button secondary "><i
														class="fas fa-edit"></i>ì‹ ì²­í•˜ëŸ¬ ê°€ê¸°</a>
												</div>
											</div>
										</c:if>
									<c:if test="${contractVo.lastStatusCode > 19 }">
										<div class="info-row">
											<span class="info-label">ê³„ì•½ ë²ˆí˜¸</span>
											<span class="info-value">${contractVo.contractNo }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë¬¼ë¥˜ì°½ê³  ì´ë¦„</span>
											<span class="info-value">${whList.whName }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë¬¼ë¥˜ì°½ê³  ì£¼ì†Œ</span>
											<span class="info-value">${whList.whAddr }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë¬¼ë¥˜ì°½ê³  íƒ€ì…</span>
											<span class="info-value">${whList.whType }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë¬¼ë¥˜ì°½ê³  ê°€ê²©</span>
											<span class="info-value"><fmt:formatNumber  value="${whList.whPrice }" pattern="#,###"/> ì›</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë‹´ë‹¹ì íšŒì‚¬</span>
											<span class="info-value">${whList.logistMngName }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë‹´ë‹¹ì ì£¼ì†Œ</span>
											<span class="info-value">${whList.logistMngAddr }</span>
										</div>
										<div class="info-row">
											<span class="info-label">ë‹´ë‹¹ì ë²ˆí˜¸</span>
											<span class="info-value">${whList.logistMngTel }</span>
										</div>
									</c:if>

									</div>
								</c:if>
								<c:if test="${contractVo.contractType == 'ìˆ˜ì¶œ' }">
									<div class="info-card">
										<div class="info-row">
											<span class="card-title">ì»¨í…Œì´ë„ˆ ì ì¬</span>
										</div>
										<c:if test="${contractVo.lastStatusCode == 38 }">
											<div>
												<div class="info-row">
													<span class="info-label" style="width: 160px">ì»¨í…Œì´ë„ˆ ìƒì„¸ ë³´ê¸°</span> <a
														href="/cca/stowageList.do" class="action-button secondary "><i
														class="fas fa-edit"></i> ìƒì„¸</a>
												</div>
											</div>
										</c:if>
										<c:if test="${contractVo.lastStatusCode > 38 }">
												<div class="info-row">
													<span class="info-label">ê³„ì•½ ë²ˆí˜¸</span>
													<span class="info-value">${contractVo.contractNo }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ì»¨í…Œì´ë„ˆ ì´ë¦„</span>
													<span class="info-value">${conList.containerName }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ì»¨í…Œì´ë„ˆ ì£¼ì†Œ</span>
													<span class="info-value">${conList.containerLocation }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ì»¨í…Œì´ë„ˆ íƒ€ì…</span>
													<span class="info-value">${conList.containerType }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ì»¨í…Œì´ë„ˆ ê°€ê²©</span>
													<span class="info-value"><fmt:formatNumber  value="${conList.containerPrice }" pattern="#,###"/> ì›</span>
												</div>
												<div class="info-row">
													<span class="info-label">ë‹´ë‹¹ì íšŒì‚¬</span>
													<span class="info-value">${conList.logistMngName }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ë‹´ë‹¹ì ì£¼ì†Œ</span>
													<span class="info-value">${conList.logistMngAddr }</span>
												</div>
												<div class="info-row">
													<span class="info-label">ë‹´ë‹¹ì ë²ˆí˜¸</span>
													<span class="info-value">${conList.logistMngTel }</span>
												</div>
										</c:if>

									</div>
								</c:if>
							</div>
						</div>

					</div>
					<div id="progress">
						<div class="info-card">
							<div class="info-row">
								<span class="card-title">ì§„í–‰ ë‚´ì—­</span>
							</div>
							<div>
								<div class="info-row">
									<div class="contract-progress-details">
										<c:forEach items="${contractVo.contractRecordList }"
											var="list" varStatus="status">
											<div style="font-weight: bold;" class="dis-f-ai-c">
												<i class="fas fa-check-circle" style="margin-right: 10px;"></i>
												${list.statusCodeMediumCategoryName } <span
													style="margin-left: 10px">${list.statusCodeName }</span>
											</div>
											<div style="margin-left: 30px">${list.contractRecordRegDate }</div>
											<c:if test="${! status.last }">
												<i class="fa-solid fa-arrow-down"
													style="margin-left: 60px; margin-bottom: 10px"></i>
											</c:if>
										</c:forEach>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script>
		$(function() {
			let listBtn = $("#listBtn")
			let ciBtn = $("#ciBtn");
			let plBtn = $("#plBtn");
			let delDBtn = $("#delDBtn");
			let delDWriteBtn = $("#delDWriteBtn");
			let kLabelWriteBtn = $("#kLabelWriteBtn");
			let kLabelDetailBtn = $("#kLabelDetailBtn");
			let taxBtn = $("#taxBtn");
			let taxOkBtn = $("#taxOkBtn");
			
			let cdBtn = $("#cdBtn");
			
			let contractNo = window.location.pathname.split("/")[3]
			console.log(contractNo);

			listBtn.on("click", function() {
				location.href = "/cca/ccaContract";
			})

			
			//ê°œì¸ì •ë³´ ë§ˆìŠ¤í‚¹
			let maskedBtn = $("#maskedBtn");
			let consignorName = $("#maskedConsignorName");
			let consignorTel = $("#maskedConsignorTel");
			
			let servantName = $("#maskedServantName");
			let servantTel = $("#maskedServantTel");
			let isMasked = true;
			
			
			function maskPhoneNumber(phoneNumber){
				 if (!phoneNumber || phoneNumber.length < 10) {
			            return phoneNumber; 
			        }
				return phoneNumber.replace(/(\d{3})-?(\d{4})-?(\d{4})/, "$1-****-$3");
			}
			
			function maskName(name){
				 if (!name || name.length < 2) {
			            return name; 
			        }
				 const firstChar = name.charAt(0);
			        const lastChar = name.charAt(name.length - 1);
			        const maskedMiddle = "*".repeat(name.length - 2); // ì¤‘ê°„ ê¸€ì ê°œìˆ˜ë§Œí¼ * ë°˜ë³µ
			        return firstChar + maskedMiddle + lastChar;
			}
		
			const originalConsignorTel = consignorTel.text().trim();
			const originalServantTel = servantTel.text().trim();
			const originalConsignorName = consignorName.text().trim();
			const originalServantName = servantName.text().trim();
			
			const maskedConsignorTel = maskPhoneNumber(originalConsignorTel);
			const maskedServantTel = maskPhoneNumber(originalServantTel);
			const maskedConsignorName = maskName(originalConsignorName);
			const maskedServantName = maskName(originalServantName);
			
			consignorName.text(maskedConsignorName); //í˜ì´ì§€ ë¡œë”©ì‹œ ë§ˆìŠ¤í‚¹ëœê±° ë³´ì´ê²Œ ã…‡ã…‡
			consignorTel.text(maskedConsignorTel); //í˜ì´ì§€ ë¡œë”©ì‹œ ë§ˆìŠ¤í‚¹ëœê±° ë³´ì´ê²Œ ã…‡ã…‡
			servantName.text(maskedServantName); //í˜ì´ì§€ ë¡œë”©ì‹œ ë§ˆìŠ¤í‚¹ëœê±° ë³´ì´ê²Œ ã…‡ã…‡
			servantTel.text(maskedServantTel); //í˜ì´ì§€ ë¡œë”©ì‹œ ë§ˆìŠ¤í‚¹ëœê±° ë³´ì´ê²Œ ã…‡ã…‡
			
			maskedBtn.on("click",function(){
				isMasked = !isMasked;
				
				if(isMasked){
					consignorTel.text(maskedConsignorTel);
					servantTel.text(maskedServantTel);
					consignorName.text(maskedConsignorName);
					servantName.text(maskedServantName);
				}else{
					consignorTel.text(originalConsignorTel);
					servantTel.text(originalServantTel);
					consignorName.text(originalConsignorName);
					servantName.text(originalServantName);
				}
			})
			
			//
			$(document).ready(function() {
				$(".tab-button").on("click", function() {
					$(".tab-button").removeClass("active");
					$(this).addClass("active");

					$(".tab-pane").removeClass("active");
					var targetTab = $(this).data('tab');
					$('#' + targetTab).addClass('active');

				})
				$('.tab-button.active').click();
			})

			//
			$(".step-circle").on("click", function() {
				let value = $(this).next(".step-label").text(); //ë²„íŠ¼ì˜ ìˆœì„œ
				let numValue = $(this).text(); //ë²„íŠ¼ì˜ ë²ˆí˜¸
				console.log(value);
				console.log(numValue);
				
				let targetDetailsDiv = $("#details-step-" + numValue);
				 $('.progress-details').not(targetDetailsDiv).slideUp();
				 
				 targetDetailsDiv.slideToggle();
				$.ajax({
					url : "/consignor/findStatusCode/" + contractNo,
					type: "get",
					data : {paramName : value},
					success : function(result){
						console.log(result);
						  let specificDivArea = targetDetailsDiv.find(".divArea");
						  
						let html = ``;
						for (let i = 0 ; i < result.length; i++){
							html += `
								<div>
									\${result[i].statusCodeName}										
								</div>
							`;
						}
						
						specificDivArea.html(html);
					}
				})
				
			})
			//
			ciBtn.on("click",function(){
				let ciNo = ciBtn.val();
				console.log("cií´ë¦­" , ciNo);
				window.open("/ci/detail.do?ciNo="+ciNo
						, "_blank"
				        , "width=800,height=1000,scrollbars=yes,resizable=yes");
			});
			
			plBtn.on("click",function(){
				let plNo = plBtn.val();
				console.log("plí´ë¦­",plNo);
				window.open("/pl/detail.do?plNo="+plNo
						, "_blank"
				        , "width=800,height=1000,scrollbars=yes,resizable=yes");
			});
			
			delDBtn.on("click",function(){
				let delDNo = delDBtn.val();
				console.log("delDí´ë¦­",delDNo);
				window.open("/contract/decl/detail.do?declDNo="+delDNo
						, "_blank"
				        , "width=800,height=1000,scrollbars=yes,resizable=yes");
				//location.href = "/contract/decl/detail.do?declDNo="+delDNo;
			})
		
			delDWriteBtn.on("click",function(){
				let contractNo = delDWriteBtn.val();
				//window.open("/contract/declform.do?contractNo="+contractNo);
				location.href = "/contract/declform.do?contractNo="+contractNo;
			})
			
			kLabelWriteBtn.on("click",function(){
				let contractNo = kLabelWriteBtn.val();
				location.href = "/cca/koreanLabelWrite.do?contractNo="+contractNo;
			})
			
			kLabelDetailBtn.on("click",function(){
				let contractNo = kLabelDetailBtn.val();
				window.open("/cca/koreanLabelDetail.do?contractNo="+contractNo
						, "_blank"
				        , "width=665,height=600,scrollbars=yes,resizable=yes");
				//location.href = "/cca/koreanLabelDetail.do?contractNo="+contractNo;
			})
			
			cdBtn.on("click",function(){
				let cdNo = cdBtn.val();
				window.open("/servant/cdDetail.do?cdNo="+cdNo
						, "_blank"
				        , "width=800,height=1000,scrollbars=yes,resizable=yes");
			})
			
			//ì„¸ê¸ˆ ë‚©ë¶€ ì „ ë²„íŠ¼
			taxBtn.on("click",function(){
				let declNo = taxBtn.val();
				window.open("/doc/taxBill.do?declNo=" + declNo ,"_blank","width=800,height=1000,scrollbars=yes,resizable=yes");
			});
			
			//ì„¸ê¸ˆ ë‚©ë¶€ í›„ ë²„íŠ¼
			taxOkBtn.on("click",function(){
				let declNo = taxOkBtn.val();
				window.open("/doc/taxBill.do?declNo=" + declNo ,"_blank","width=800,height=1000,scrollbars=yes,resizable=yes");
			});
			
		})
	</script>
</body>
</html>