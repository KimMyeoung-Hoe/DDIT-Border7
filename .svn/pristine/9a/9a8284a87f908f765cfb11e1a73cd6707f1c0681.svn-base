<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c"%>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í”„ë¡œí•„ í˜ì´ì§€</title>
<%@ include file="../modules/header.jsp" %>
<%@ include file="../modules/sidebar.jsp" %>
<%@ include file="../modules/modal.jsp" %>
<link rel="stylesheet" href="/css/main.css">
<style>
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
	background-color: #f8f9fa;
	color: #333;
	line-height: 1.5;
}

/* Header */
.header {
	padding: 15px 20px;
	border-bottom: 1px solid #e9ecef;
	display: flex;
	align-items: center;
	gap: 10px;
}

.back-btn {
	background: none;
	border: none;
	font-size: 18px;
	color: #6c757d;
	cursor: pointer;
	padding: 5px;
}

.header-title {
	font-size: 14px;
	color: #6c757d;
}

/* Profile Section */
.profile-section {
	padding: 20px;
	display: flex;
	gap: 15px;
	align-items: flex-start;
	position: relative;
}

.profile-avatar {
	width: 60px;
	height: 60px;
	background-color: #e9ecef;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 24px;
	color: #6c757d;
	flex-shrink: 0;
}

.profile-info {
	flex: 1;
}

.profile-name {
	font-size: 18px;
	font-weight: bold;
	margin-bottom: 5px;
	color: #212529;
}

.profile-details {
	font-size: 13px;
	color: #6c757d;
}

.contact-info {
	font-size: 12px;
	color: #6c757d;
}

.contact-info div {
	margin: 3px 0;
	display: flex;
	align-items: center;
	gap: 5px;
}

.edit-link {
	position: absolute;
	top: 20px;
	right: 20px;
	font-size: 12px;
	color: #007bff;
	text-decoration: none;
}

/* Stats Section */
.stats-section {
	padding: 20px;
	display: flex;
	gap: 40px;
	border-top: 1px solid #e9ecef;
	position: relative;
	align-items: center;
	justify-content: space-around;
}

.stat-item {
	text-align: center;
	position: relative;
}

.stat-number {
	font-size: 28px;
	font-weight: bold;
	margin-bottom: 5px;
}

.stat-number.red {
	color: #dc3545;
}

.stat-number.green {
	color: #28a745;
}

.stat-label {
	font-size: 11px;
	color: #6c757d;
	line-height: 1.3;
}

/* Office Location */
.office-section {
	margin: 20px;
	border: 2px solid #dee2e6;
	border-radius: 8px;
	text-align: center;
	background-color: #f8f9fa;
	position: relative;
}

.office-title {
	font-size: 18px;
	color: #495057;
	font-weight: 500;
}

/* Work Categories */
.categories-section {
	padding: 20px;
	border-top: 1px solid #e9ecef;
}

.categories-title {
	font-size: 13px;
	font-weight: bold;
	margin-bottom: 15px;
	color: #495057;
}

.category-options {
	display: flex;
	gap: 20px;
	margin-bottom: 20px;
}

.category-item {
	display: flex;
	align-items: center;
	gap: 8px;
	font-size: 13px;
	color: #495057;
}

.category-checkbox {
	width: 16px;
	height: 16px;
	accent-color: #28a745;
}

/* Update Button */
.update-btn {
	width: 100%;
	padding: 12px;
	background-color: #007bff;
	color: white;
	border: none;
	border-radius: 6px;
	font-size: 13px;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 5px;
}

.update-btn:hover {
	background-color: #0056b3;
}

/* íƒ­ ì»¨í…Œì´ë„ˆ */
.tabs-container {
	width: 100%;
	margin: 20px 0;
	border: 1px solid #ddd;
	border-radius: 5px;
	overflow: hidden; /* ë‚´ìš©ì´ ë„˜ì¹  ê²½ìš° ìŠ¤í¬ë¡¤ ì²˜ë¦¬ */
}

/* íƒ­ í—¤ë” (ë²„íŠ¼ ë¶€ë¶„) */
.tabs-header {
	display: flex; /* ë²„íŠ¼ë“¤ì„ ê°€ë¡œë¡œ ë‚˜ì—´ */
	background-color: #f1f1f1;
	border-bottom: 1px solid #ddd;
}

/* ê° íƒ­ ë²„íŠ¼ */
.tab-button {
	padding: 15px 20px;
	cursor: pointer;
	text-align: center;
	flex-grow: 1; /* ë²„íŠ¼ë“¤ì´ ê· ë“±í•˜ê²Œ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ */
	transition: background-color 0.3s ease; /* í˜¸ë²„ íš¨ê³¼ */
	border-right: 1px solid #eee; /* ë²„íŠ¼ êµ¬ë¶„ì„  */
}

.tab-button:last-child {
	border-right: none; /* ë§ˆì§€ë§‰ ë²„íŠ¼ì€ ì˜¤ë¥¸ìª½ ì„  ì œê±° */
}

.tab-button:hover {
	background-color: #e9e9e9;
}

/* í™œì„±í™”ëœ íƒ­ ë²„íŠ¼ */
.tab-button.active {
	background-color: #fff;
	border-bottom: 2px solid #007bff; /* í™œì„±í™”ëœ íƒ­ í•˜ë‹¨ì— ê°•ì¡°ì„  */
	color: #007bff;
	font-weight: bold;
}

/* íƒ­ ë‚´ìš© */
.tabs-content {
	padding: 20px;
	background-color: #fff;
}

/* ê° íƒ­ íŒ¨ë„ (ë‚´ìš© ë¶€ë¶„) */
.tab-pane {
	display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
}

/* í™œì„±í™”ëœ íƒ­ íŒ¨ë„ */
.tab-pane.active {
	display: block; /* í™œì„±í™”ë˜ë©´ ë³´ì„ */
}

/* Icons */
.icon {
	width: 12px;
	height: 12px;
	display: inline-block;
}
</style>
</head>
<body>
	<div class="app-container">
		<main class="main-content-area">
			<div class="content-header">
					<!-- ë¸Œë ˆë“œí¬ëŸ¼ ì—˜ë¦¬ë¨¼íŠ¸ -->
					<div class="breadcrumb-warp">
						<div class="col-sm-12">
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="/">Home</a></li>
								<li class="breadcrumb-item"><a href="/consignor/ccaList.do">ê´€ì„¸ì‚¬ ì •ë³´ ë³´ê¸°</a></li>
								<li class="breadcrumb-item"><a href="#">ê´€ì„¸ì‚¬ ìƒì„¸ ì •ë³´</a></li>
							</ol>
						</div>
					</div>

					<div class="content-title">ê´€ì„¸ì‚¬ ìƒì„¸ ì •ë³´</div>
					<p class="desc">ê´€ì„¸ì‚¬ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
				</div>
			<div class="container section">
				<!-- Progress Section -->
				<div class="progress-section">
					<div class="progress-bar-container">
						<div class="progress-bar">
							<div class="progress-step">
								<button class="step-circle active">1</button>
								<span class="step-label">ê´€ì„¸ì‚¬ ì„ íƒ</span>
							</div>
							<div class="progress-step">
								<button class="step-circle inactive"> 2 </button>
								<span class="step-label">ê¸°ë³¸ ì •ë³´ ì…ë ¥</span>
							</div>
							<div class="progress-step">
								<button class="step-circle inactive"> 3 </button>
								<span class="step-label">ì„œë¥˜ ì œì¶œ</span>
							</div>
						</div>
					</div>
				</div>

				<!-- Profile Section -->
				<div class="profile-section">
					<c:if
						test="${ccavo.ccaProfileImg == null  ||ccavo.ccaProfileImg == '' }">
						<div class="profile-avatar">ğŸ‘¤</div>
					</c:if>
					<c:if
						test="${!(ccavo.ccaProfileImg == null  ||ccavo.ccaProfileImg == '' )}">
						<img src="/myPage/displayFile?fileName=${ccavo.ccaProfileImg}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" style="width: 200px; height: 250px">
					</c:if>
					<div class="profile-info">
						<div class="profile-name">${ccavo.ccaName } 
							<button class="" style="border: 1px solid;" id="maskedBtn"><i class="fas fa-eye"></i></button>
						</div>
						<div class="profile-details">
							ì£¼ë ¥ë¶„ì•¼:
							<c:forEach items="${ccavo.specialtyNameList }" var="cca"
								varStatus="status">
								<span class="profile-details"> ${cca.specialtyName } <c:if
										test="${!status.last }">
                   				,
                   			</c:if>
								</span>
							</c:forEach>
						</div>
						<div class="contact-info">
							<div>
								<span class="">ğŸ“§ </span> <span>ì´ë©”ì¼:
									${ccavo.userEmail }</span>
							</div>
							<div>
								<span class="">ğŸ“± </span> <span>íœ´ëŒ€í°: <span id="userTel">${ccavo.userTel }</span></span>
							</div>
							<div>
								<span class="">â˜ï¸ </span> <span>ë‚´ì„ ë²ˆí˜¸: ${ccavo.ccaTel } </span>
							</div>
							<div>
								<span class="">ğŸ“  </span> <span>íŒ©ìŠ¤ë²ˆí˜¸: ${ccavo.userFax }</span>
							</div>
						</div>
					</div>
					<div>
						<button class="btn btn-primary" id="updateBtn">ğŸ“ì˜ë¢°í•˜ê¸°</button>
						<button class="btn btn-primary" id="backBtn">ëª©ë¡ê°€ê¸°</button>					
					</div>
				</div>

				<!-- Stats Section -->
				<div class="stats-section">
					<div class="stat-item">
						 <%-- <div class="stat-number red">${ccavo.ccaSanctionScore }</div>  --%>
						 <c:if test="${totalScore.sanctionScore == '' || totalScore.sanctionScore == null }">
						 	<div class="stat-number red">0ì </div>
						 </c:if>
						 <c:if test="${! empty totalScore.sanctionScore }">
						 	 <div class="stat-number red">${totalScore.sanctionScore }ì </div> 
						 </c:if>
						 
						<div class="stat-label">ì˜¤ë¥˜ì ìˆ˜</div>
					</div>
					<div class="stat-item">
						<div class="stat-number green">${ccavo.infallible }%</div>
						<div class="stat-label">ë¬´ì˜¤ë¥˜ ì²˜ë¦¬ìœ¨</div>
					</div>
				</div>

				<!-- Office Location -->
				<div class="office-section">
					<input type="hidden" id="ccaAddr" value="${ccavo.ccaAddr }">
					<input type="hidden" id="ccaDetAddr" value="${ccavo.ccaDetAddr }">
					<div id="map" style="width: 100%; height: 300px; display: none;"></div>
				</div>

				<!-- Work Categories -->
				<div class="categories-section">
					<div class="tabs-container">
						<div class="tabs-header">
							<!-- <div class="tab-button  categories-title" data-tab="field">ì—…ë¬´
								ë¶„ì•¼</div> -->
							<div class="tab-button active categories-title" data-tab="recent">ë‚˜ì˜ ì˜ë¢° ë‚´ì—­</div>
							<div class="tab-button categories-title" data-tab="error">ì˜¤ë¥˜
								ì ìˆ˜ ë¶€ê³¼ ë‚´ì—­</div>
						</div>

						<div class="tabs-content">

						<%-- 	<div class="tab-pane active category-options" id="field">
								<c:forEach items="${ccavo.specialtyNameList }" var="cca"
									varStatus="status">
									<input type="checkbox" class="category-checkbox" checked>
									<span class="profile-details"> ${cca.specialtyName } </span>
								</c:forEach> 
							</div> --%>

						<%-- 	<div class="tab-pane" id="recent">
								<c:if test="${empty withMeContract }">
									<span>ì˜ë¢° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</span>
								</c:if>
								<c:forEach items="${withMeContract }" var="me">
									<div>
										<span>ì ‘ìˆ˜ ë²ˆí˜¸: ${me.contractNo }</span>
										<span>, ì ‘ìˆ˜ íƒ€ì…: ${me.contractType }</span>
										<span>, ì ‘ìˆ˜ íƒ€ì…: ${me.contractType }</span>
										<span>, ì ‘ìˆ˜ í˜„í™©: ${me.contractRecordList[0].statusCodeMediumCategoryName } ${me.contractRecordList[0].statusCodeName } </span>
									</div>
								</c:forEach>									
							</div> --%>
							
							<div class="tab-pane" id="recent">
							    <c:if test="${empty withMeContract}">
							        <span class="no-contract-message">ë‚˜ì™€ì˜ ì˜ë¢° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</span>
							    </c:if>
							    <c:forEach items="${withMeContract}" var="me">
							        <div class="contract-item" style="margin-bottom: 10px">
							            <div class="contract-header">
							                <span class="contract-no">ì ‘ìˆ˜ ë²ˆí˜¸: <strong><a href="/consignor/detailContract/${me.contractNo }"> ${me.contractNo}</a></strong></span>
							                <span class="contract-type">${me.contractType}</span>
							            </div>
							            <div class="contract-status">
							                <span class="status-category">ì ‘ìˆ˜ í˜„í™©: ${me.contractRecordList[0].statusCodeMediumCategoryName}</span>
							                <span class="status-name">${me.contractRecordList[0].statusCodeName}</span>
							            </div>
							        </div>
							    </c:forEach>
							</div>

							<div class="tab-pane" id="error">
								<c:if test="${empty sanctionScoreList }">
									<span><span>ğŸ‰</span>ì˜¤ë¥˜ ì ìˆ˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.<span>ğŸ‰</span></span>
								</c:if>
								<c:forEach items="${sanctionScoreList }" var="score">
									<div>
										<fmt:parseDate value="${score.sanctionDate }" pattern="yyyy-MM-dd" var="date"/>
										<fmt:formatDate value="${date }" pattern="yyyy-MM-dd"/>  - ${score.sanctionName } : <span style="color: red">${score.sanctionScore }ì </span>
									</div>
								</c:forEach>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>
	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e8306615f01d266edffd26c9c180c3c4&libraries=services"></script>
	<script
		src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script type="text/javascript">
		$(function() {

			let backBtn = $("#backBtn");
			let updateBtn = $("#updateBtn");

			updateBtn
					.on(
							"click",
							function() {
								//console.log(window.location.href);
								location.href = "/consignor/writeContract.do?ccaNo=${ccavo.userNo}";
							})

			backBtn.on("click", function() {
				location.href = "/consignor/ccaList.do";
			})
			
			
			
			//ê°œì¸ì •ë³´ ë§ˆìŠ¤í‚¹
			let maskedBtn = $("#maskedBtn");
			let userTel = $("#userTel");
			let isMasked = true;
			
			function maskPhoneNumber(phoneNumber){
				 if (!phoneNumber || phoneNumber.length < 10) {
			            return phoneNumber; 
			        }
				return phoneNumber.replace(/(\d{3})-?(\d{4})-?(\d{4})/, "$1-****-$3");
			}
			
			const originalPhoneNumber = userTel.text().trim();
			const maskedPhoneNumber = maskPhoneNumber(originalPhoneNumber);
			
			userTel.text(maskedPhoneNumber); //í˜ì´ì§€ ë¡œë”©ì‹œ ë§ˆìŠ¤í‚¹ëœê±° ë³´ì´ê²Œ ã…‡ã…‡
			
			maskedBtn.on("click",function(){
				isMasked = !isMasked;
				
				if(isMasked){
					userTel.text(maskedPhoneNumber);
				}else{
					userTel.text(originalPhoneNumber);
				}
			})
			
			//ì§€ë„
			let address1 = $("#ccaAddr").val(); // ê¸°ë³¸ì£¼ì†Œê°’
			let address2 = $("#ccaDetAddr").val(); // ìƒì„¸ì£¼ì†Œê°’

			if (address1 && address1.trim() !== "") {
				let $mapContainer = $("#map"); // jQuery ê°ì²´ë¡œ ì„ íƒ (ë³€ìˆ˜ëª… ì•ì— '$'ë¥¼ ë¶™ì—¬ êµ¬ë³„í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤)
				$mapContainer.show(); // jQuery ë©”ì„œë“œë¡œ display ì†ì„± ë³€ê²½

				// *** ì´ ë¶€ë¶„ì´ í•µì‹¬ì…ë‹ˆë‹¤: jQuery ê°ì²´ì—ì„œ ìˆœìˆ˜í•œ DOM ìš”ì†Œë¡œ ë³€í™˜ ***
				let mapDomElement = $mapContainer[0]; // ë˜ëŠ” $mapContainer.get(0);

				let mapOption = {
					center : new kakao.maps.LatLng(33.450701, 126.570667),
					level : 3
				};

				// ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ (ì´ì œ mapDomElementëŠ” ìˆœìˆ˜í•œ DOM ìš”ì†Œì…ë‹ˆë‹¤)
				var map = new kakao.maps.Map(mapDomElement, mapOption);

				var geocoder = new kakao.maps.services.Geocoder();

				geocoder
						.addressSearch(
								address1 + " " + address2,
								function(result, status) {

									if (status === kakao.maps.services.Status.OK) {
										var coords = new kakao.maps.LatLng(
												result[0].y, result[0].x);
										var marker = new kakao.maps.Marker({
											map : map,
											position : coords
										});
										var infowindow = new kakao.maps.InfoWindow(
												{
													content : '<div style="width:150px;text-align:center;padding:6px 0;">ì‚¬ë¬´ì‹¤ ìœ„ì¹˜</div>'
												});
										infowindow.open(map, marker);
										map.setCenter(coords);
									} else {
										console.error("ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨:", status);
									}
								});
				// $("#card-signup").css("top","140px"); 
			} else {
				let $mapContainer = $("#map");
				if ($mapContainer.length) {
					$mapContainer.hide();
				}
				console.log("ì£¼ì†Œ ì •ë³´ê°€ ì—†ì–´ì„œ ì§€ë„ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
			}

			//
			$(document).ready(function() {
				$(".tab-button").on("click", function() {
					$(".tab-button").removeClass("active");
					$(this).addClass("active");

					$(".tab-pane").removeClass("active");
					var targetTab = $(this).data('tab');
					$('#' + targetTab).addClass('active');

				})
				$('.tab-button.active').click();
				
			})

		});
	</script>
</body>
</html>